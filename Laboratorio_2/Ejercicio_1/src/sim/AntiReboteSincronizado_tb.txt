`timescale 1ms / 1ns

module AntiReboteSincronizado_tb;

    // Declaración de señales para el testbench
    reg clk;                        // Señal de reloj
    reg rst;                        // Señal de reset
    reg entradaAsincronica;         // Señal de entrada (simulación de un pulsador con rebotes)
    wire salidaSincronizada;        // Señal de salida filtrada, sin rebotes y sincronizada

    // Instancia del módulo bajo prueba (Unit Under Test - UUT)
    AntiReboteSincronizado uut (
        .clk(clk),
        .rst(rst),
        .entradaAsincronica(entradaAsincronica),
        .salidaSincronizada(salidaSincronizada)
    );

    // Generador de reloj: frecuencia de 27 MHz (periodo de 37 ns)
    always #0.0000185 clk = ~clk;   // Alterna la señal de reloj cada 18.5 ns para simular una frecuencia de 27 MHz

    // Proceso inicial
    initial begin
        // Inicialización de señales
        clk = 0;
        rst = 0;
        entradaAsincronica = 0;

        // Esperamos unos ciclos antes de liberar el reset
        #10;
        rst = 1;  // Liberamos el reset

        // Simulación de rebotes en el botón
        // Los rebotes suceden dentro del marco de los primeros 2 ms (54,000 ciclos)
        #0.2 entradaAsincronica = 1;  // Botón presionado (simulación de pulsación)
        #0.1 entradaAsincronica = 0;  // Rebote: cambia rápidamente a 0
        #0.2 entradaAsincronica = 1;  // Rebote: cambia rápidamente a 1
        #0.2 entradaAsincronica = 0;  // Rebote: vuelve a 0
        #0.1 entradaAsincronica = 1;  // Rebote: vuelve a 1
        #0.3 entradaAsincronica = 0;  // Rebote: vuelve a 0
        #0.2 entradaAsincronica = 1;  // Finalmente permanece en 1
        // Ahora esperamos 1 ms más para completar un total de 2 ms
        #1;

        // Soltamos el botón (cambia a 0)
        entradaAsincronica = 0;
        #5
        #0.1 entradaAsincronica = 1;  // Botón presionado (simulación de pulsación)
        #0.1 entradaAsincronica = 0;  // Rebote: cambia rápidamente a 0
        #0.2 entradaAsincronica = 1;  // Rebote: cambia rápidamente a 1
        #0.2 entradaAsincronica = 0;  // Rebote: vuelve a 0
        #0.1 entradaAsincronica = 1;  // Rebote: vuelve a 1
        #0.2 entradaAsincronica = 0;  // Rebote: vuelve a 0
        #0.2 entradaAsincronica = 1;  // Finalmente permanece en 1
        // Ahora esperamos 1 ms más para completar un total de 2 ms
        #1;

        // Soltamos el botón (cambia a 0)
        entradaAsincronica = 0;
        #5
        // Finalizamos la simulación después de un tiempo adicional
        #10;
        $finish;
    end

    // Monitor de señales para ver los cambios en la simulación
    initial begin
        $monitor("Time=%t : entradaAsincronica=%b, salidaSincronizada=%b", $time, entradaAsincronica, salidaSincronizada);
    end

    initial begin
            $dumpfile("AntiReboteSincronizado_tb.vcd");
            $dumpvars(0,AntiReboteSincronizado_tb);
    end

endmodule